<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trade | Trading Academy</title>
  <link rel="stylesheet" href="/static/styles.css">
</head>
<body>

  <!-- Navigation Bar -->
  <nav class="navbar">
    <ul>
      <li><a href="/">Home</a></li>
      <li><a href="/trade">Trade</a></li>
      <li><a href="/portfolio">Portfolio</a></li>
      <li><a href="/articles">Articles</a></li>
      <li><a href="/glossary">Glossary</a></li>
      <li><a href="/logout">Logout</a></li>
    </ul>
  </nav>

  <!-- Sidebar for Common Assets -->
  <div class="sidebar">
      <h2>Common Assets</h2>
      {% for category, asset_list in assets.items() %}
          <h3>{{ category }}</h3>
          <ul>
              {% for asset in asset_list %}
                  <li><a href="/trade?asset={{ asset }}">{{ asset }}</a></li>
              {% endfor %}
          </ul>
      {% endfor %}
  </div>

  <!-- Main Trading Content -->
  <main class="trading-content">

    <!-- Stock Search Section -->
    <section class="search-section">
      <h1>Search for a Stock</h1>
      <form method="POST" action="/trade">
        <label for="asset_name">Asset Name (Ticker):</label>
        <input type="text" id="asset_name" name="asset_name" placeholder="Enter Stock Symbol" required><br>

        <label for="timeframe">Timeframe:</label>
        <select id="timeframe" name="timeframe">
          <option value="6mo">6 Months</option>
          <option value="1mo">1 Month</option>
          <option value="1wk">1 Week</option>
          <option value="1y">1 Year</option>
        </select><br>

        <button type="submit" name="search_stock" class="btn">Search Stock</button>
      </form>
    </section>

    <!-- Display Section for Stock Data -->
    <section class="chart-section">
      {% if asset_name %}
        <h1>Trade {{ asset_name }}</h1>

        <!-- Trading Graph -->
        <div id="stock-graph">
          {{ graph_html | safe }}
        </div>
      {% endif %}
    </section>

      <!-- Flash Messages for Alerts -->
      {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="flash-message-box">
          {% for message in messages %}
            <div class="flash-message">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- Right Trading Controls -->
    {% if asset_name %}
      <section class="right-section">
        <h1>Trade {{ asset_name }}</h1>
        <form action="/trade" method="POST">
          <input type="hidden" name="asset_name" value="{{ asset_name }}">

          <label for="quantity">Quantity:</label>
          <input type="number" id="quantity" name="quantity" required><br>

          <label for="stop_loss">Stop Loss ($):</label>
          <input type="number" id="stop_loss" name="stop_loss" step="0.01" placeholder="Enter Stop Loss (optional)"><br>

          <label for="take_profit">Take Profit ($):</label>
          <input type="number" id="take_profit" name="take_profit" step="0.01" placeholder="Enter Take Profit (optional)"><br>

          <button type="submit" name="action" value="buy" class="btn">Buy</button>
          <button type="submit" name="action" value="short" class="btn btn-danger">Short</button>
        </form>

        <!-- Company Information -->
        <div class="company-info">
          <h2>Company Overview for {{ asset_name }}</h2>
          <p><strong>Current Price:</strong> ${{ company_info.current_price }}</p>
          <p><strong>Market Cap:</strong> ${{ company_info.market_cap }}</p>
          <p><strong>P/E Ratio:</strong> {{ company_info.pe_ratio }}</p>
          <p><strong>52-Week High:</strong> ${{ company_info.high_52_week }}</p>
          <p><strong>52-Week Low:</strong> ${{ company_info.low_52_week }}</p>
          <p><strong>Description:</strong> {{ company_info.description }}</p>
        </div>
      </section>
    {% endif %}
  </main>

</body>
</html>
